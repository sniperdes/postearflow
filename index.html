<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Content Automation - Demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="text-center mb-4">Content Automation</h1>
    <p class="text-center">Registrate, elegí tu plan y probá cómo funciona la plataforma 🚀</p>

    <!-- Registro -->
    <div class="card mb-4">
      <div class="card-header">Registro</div>
      <div class="card-body">
        <input id="regEmail" class="form-control mb-2" placeholder="Email">
        <input id="regPass" type="password" class="form-control mb-2" placeholder="Contraseña">

        <select id="regPlan" class="form-select mb-2">
          <option value="básico">Plan Básico</option>
          <option value="pro">Plan Pro</option>
          <option value="premium">Plan Premium</option>
        </select>

        <button class="btn btn-primary w-100" onclick="register()">Registrarse</button>
      </div>
    </div>

    <!-- Login -->
    <div class="card mb-4">
      <div class="card-header">Login</div>
      <div class="card-body">
        <input id="loginEmail" class="form-control mb-2" placeholder="Email">
        <input id="loginPass" type="password" class="form-control mb-2" placeholder="Contraseña">
        <button class="btn btn-success w-100" onclick="login()">Ingresar</button>
      </div>
    </div>

    <!-- Crear solicitud de contenido -->
    <div class="card mb-4 d-none" id="contentCard">
      <div class="card-header">Crear solicitud de contenido</div>
      <div class="card-body">
        <select id="serviceType" class="form-select mb-2">
          <option value="instagram">Instagram</option>
          <option value="youtube">YouTube</option>
          <option value="tiktok">TikTok</option>
        </select>
        <textarea id="contentText" class="form-control mb-2" placeholder="Escribí el contenido a generar"></textarea>
        <button class="btn btn-warning w-100" onclick="createRequest()">Enviar solicitud</button>
      </div>
    </div>

    <!-- Ver solicitudes -->
    <div class="card d-none" id="requestsCard">
      <div class="card-header">Mis solicitudes</div>
      <div class="card-body" id="requestsList"></div>
    </div>
  </div>

  <script>
    const API_URL = "http://localhost:8000";
    let currentUser = null;

    async function register() {
      const email = document.getElementById("regEmail").value;
      const password = document.getElementById("regPass").value;
      const plan = document.getElementById("regPlan").value;

      const res = await fetch(`${API_URL}/register`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ email, password, plan })
      });

      const data = await res.json();
      alert(data.message || JSON.stringify(data));
    }

    async function login() {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPass").value;

      const res = await fetch(`${API_URL}/login`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ email, password })
      });

      if (res.ok) {
        const data = await res.json();
        alert(data.message);
        currentUser = data.user_id;
        document.getElementById("contentCard").classList.remove("d-none");
        document.getElementById("requestsCard").classList.remove("d-none");
        loadRequests();
      } else {
        alert("Error en login");
      }
    }

    async function createRequest() {
      if (!currentUser) return alert("Debes iniciar sesión primero");

      const service_type = document.getElementById("serviceType").value;
      const content_text = document.getElementById("contentText").value;

      const res = await fetch(`${API_URL}/users/${currentUser}/content`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ service_type, content_text })
      });

      const data = await res.json();
      alert(data.message);
      loadRequests();
    }

    async function loadRequests() {
      if (!currentUser) return;

      const res = await fetch(`${API_URL}/users/${currentUser}/requests`);
      const data = await res.json();

      let html = "";
      data.requests.forEach(r => {
        html += `<div class="border p-2 mb-2"><b>${r.service_type}</b>: ${r.content_text} <i>(${r.status})</i></div>`;
      });

      document.getElementById("requestsList").innerHTML = html || "Sin solicitudes aún";
    }
  </script>
</body>
</html>
